listen: "127.0.0.1:8080"

# 可选：开启入站 HTTPS
# inbound_tls:
#   cert_path: "./certs/server.crt"
#   key_path: "./certs/server.key"
#   # 若 cert/key 不配置，自动复用或生成自签名证书
#   self_signed_cert_path: "./certs/gateway-selfsigned.crt"
#   self_signed_key_path: "./certs/gateway-selfsigned.key"

gateway_auth:
  tokens:
    - "gw_dev_token"
  token_sources:
    - type: "authorization_bearer"
    - type: "header"
      name: "x-gw-token"

routes:
  - id: "openai"
    prefix: "/openai"
    upstream:
      base_url: "https://api.openai.com"
      strip_prefix: true
      connect_timeout_ms: 10000
      request_timeout_ms: 60000
      # 可选：为该上游单独配置出站代理（http / https / socks）
      # proxy:
      #   protocol: "http"
      #   address: "127.0.0.1:7890"
      #   username: "proxy_user"
      #   password: "proxy_pass"
      # 可选：覆盖全局上游按 key 并发上限（每个 key）
      # upstream_key_max_inflight: 8
      inject_headers:
        - name: "authorization"
          value: "Bearer sk-dev-placeholder"
      remove_headers:
        - "authorization"
        - "x-forwarded-for"
        - "forwarded"
        - "cf-connecting-ip"
        - "true-client-ip"
      forward_xff: false

cors:
  enabled: false
  allow_origins: []
  allow_headers: []
  allow_methods: []
  expose_headers: []

observability:
  logging:
    level: "info"
    format: "json"
    to_stdout: true
    file:
      enabled: true
      dir: "./logs"
      prefix: "ai-gw-lite"
      rotation: "daily"
      max_files: 7
  metrics:
    enabled: true
    path: "/metrics"
    token: "metrics_dev_token"
    # 内置轻量观测页面: /metrics/ui
    # 观测 JSON 摘要接口: /metrics/summary (Bearer metrics_dev_token)
  tracing:
    enabled: true
    sample_ratio: 0.05
    # 可选：启用 OTLP 导出（例如 OpenTelemetry Collector）
    otlp:
      endpoint: "http://127.0.0.1:4317"
      timeout_ms: 3000

# Phase 2：下游固定窗口限流（按 token + route 维度）
# rate_limit:
#   per_minute: 120

# Phase 2：并发保护
# concurrency:
#   # 下游全局并发上限（gateway 入站）
#   downstream_max_inflight: 100
#   # 上游按 key 并发上限（可被 routes[].upstream.upstream_key_max_inflight 覆盖）
#   upstream_per_key_max_inflight: 8
